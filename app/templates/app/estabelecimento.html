{% extends 'base_app.html' %}
{% load static %}

{% block content %}
<!-- LOGO DO ESTABELECIMENTO -->
<div class="mb-3 d-flex gap-2 align-items-center justify-content-center">
    <div>
        {% if estabelecimento.logo %}
            <img src="{{ estabelecimento.logo.url }}" class="img-fluid rounded-circle" alt="Foto do estabelecimento" style="width: 60px; height: 60px; object-fit: cover;">
        {% else %}
            <img src="{% static 'images/sem-foto.jpg' %}" class="card-img-top rounded" alt="Foto do produto" style="width: 60px; height: 60px; object-fit: cover;">
        {% endif %}
    </div>
    <span class="fs-4 fw-bold">
        {{ estabelecimento.nome }}
    </span>
</div>
<!-- FIM - LOGO DO ESTABELECIMENTO -->

<!-- PRODUTOS DESTAQUES -->
{% if produtos_destaque %}
<div class="bg-light p-2 rounded mb-3">
    <h5 class="mb-2" style="font-size: 12px;">Produtos em destaque</h5>
    <div class="d-flex flex-row overflow-auto gap-2 pb-2">
        {% for produto in produtos_destaque %}
        <a href="{% url 'app_produto_detail' estabelecimento.id produto.id %}">
            <div class="card bg-light border-0" style="width: 85px; height: auto;">
                {% if produto.logo %}
                    <img src="{{ produto.logo.url }}" class="card-img-top rounded" alt="Foto do produto" style="width: 100%; height: 75px; object-fit: cover;">
                {% else %}
                    <img src="{% static 'images/sem-foto.jpg' %}" class="card-img-top rounded" alt="Foto do produto" style="width: 100%; height: 75px; object-fit: cover;">
                {% endif %}
                <div class="card-body p-2 d-flex flex-column">
                    <h6 class="card-title mb-1" style="font-size: 8px;">
                        {{ produto.nome|truncatechars:35 }}
                    </h6>
                    <p class="card-text text-muted mt-auto mb-0" style="font-size: 10px;">
                        R$ {{ produto.preco }}
                    </p>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
<!-- FIM - PRODUTOS DESTAQUES -->

<!-- PRODUTOS EM PROMOÇÃO -->
{% if produtos_promocao %}
<div class="bg-light p-2 rounded mb-3">
    <h5 class="mb-2" style="font-size: 12px;">Produtos em promoção</h5>
    <div class="d-flex flex-row overflow-auto gap-2">
        {% for produto in produtos_promocao %}
        <a href="{% url 'app_produto_detail' estabelecimento.id produto.id %}">
            <div class="card bg-light border-0" style="width: 85px; height: auto;">
                {% if produto.logo %}
                    <img src="{{ produto.logo.url }}" class="card-img-top rounded" alt="Foto do produto" style="width: 100%; height: 75px; object-fit: cover;">
                {% else %}
                    <img src="{% static 'images/sem-foto.jpg' %}" class="card-img-top rounded" alt="Foto do produto" style="width: 100%; height: 75px; object-fit: cover;">
                {% endif %}
                <div class="card-body p-2 d-flex flex-column">
                    <h6 class="card-title mb-1" style="font-size: 8px;">
                        {{ produto.nome|truncatechars:35 }}
                    </h6>
                    <p class="card-text text-muted mt-auto mb-0" style="font-size: 10px;">
                        R$ {{ produto.preco }}
                    </p>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
<!-- FIM - PRODUTOS EM PROMOÇÃO -->

<!-- LISTAGEM DAS CATEGORIAS E PRODUTOS -->
<div class="accordion accordion-flush" id="accordionFlushExample">
  {% for categoria in categorias %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="flush-heading{{ forloop.counter }}">
      <button class="accordion-button collapsed" type="button" 
              data-bs-toggle="collapse" 
              data-bs-target="#flush-collapse{{ forloop.counter }}" 
              aria-expanded="false" 
              aria-controls="flush-collapse{{ forloop.counter }}">
        {{ categoria.nome }}
      </button>
    </h2>
    <div id="flush-collapse{{ forloop.counter }}" class="accordion-collapse collapse" 
         aria-labelledby="flush-heading{{ forloop.counter }}" 
         data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          {% for produto in categoria.produtos.all %}
            <a href="{% url 'app_produto_detail' estabelecimento.id produto.id %}">
                <div class="mb-3 {% if not forloop.first %}border-top{% endif %} pt-2">
                    <div class="row">
                        <div class="col-3">
                            {% if produto.logo %}
                                <img src="{{ produto.logo.url }}" class="img-fluid rounded" alt="Foto do produto" style="width: 100%; height: 60px; object-fit: cover;">
                            {% else %}
                                <img src="{% static 'images/sem-foto.jpg' %}" class="card-img-top rounded" alt="Foto do produto" style="width: 100%; height: 75px; object-fit: cover;">
                            {% endif %}
                        </div>
                        <div class="col-9 card-body">
                            <h5 class="card-title text-black">{{ produto.nome }}</h5>
                            <p class="mt-1 card-text text-secondary" style="font-size: 14px;">
                                {{ produto.descricao }}
                            </p>
                            <span class="text-primary">
                                R$ {{ produto.preco }}
                            </span>
                        </div>
                    </div>
                </div>
            </a>
          {% empty %}
            <p class="card-text text-secondary" style="font-size: 14px;">Nenhum produto nesta categoria.</p>
          {% endfor %}
        </div>
    </div>
  </div>
  {% endfor %}
</div>
<!-- FIM - LISTAGEM DAS CATEGORIAS E PRODUTOS -->
{% endblock content %}
